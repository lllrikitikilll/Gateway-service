## Разработка сервиса

Для установки импользуется `poetry=^1.8.3`

```bash
git pull git@hub.mos.ru:shift-python/y2024/homeworks/apanin/gateway_api.git
poetry install --dev

# Устанавливаем подмодули
git submodule init
git submodule update

# Запуск группы сервисов
docker-compose up -d
```
По умолчанию сервис будет работать по адрессу `127.0.0.1:8000`
Работа с api сервиса `127.0.0.1:8000/docs`


## Структура проекта:
```bash
├── Dockerfile               # Dockerfile для сборки контейнера приложения.
├── pytest.ini               # Конфигурация для тестирования с помощью pytest.
├── service_auth             # Директория с исходным кодом сервиса аутентификации.
├── service_face_vector      # Директория с исходным кодом сервиса для работы с векторными представлениями лиц.
├── service_transaction      # Директория с исходным кодом сервиса для управления транзакциями.
├── setup.cfg                # Дополнительные конфигурации для различных инструментов разработки.
└── src                      # Основная директория с исходным кодом проекта.
    └── app                  # Основное приложение, реализованное на FastAPI.
        ├── api              # Директория с маршрутами и обработчиками API.
        │   ├── healthz
        │   │   └── healthz_router.py   # Запросы к внешним серверам, проверка работоспособности
        │   ├── auth_router.py        # Маршруты и обработчики для аутентификации.
        │   ├── client.py             # Клиент для работы с маршрутами сервисов
        │   ├── registrate_router.py  # Маршруты для регистрации пользователей.
        │   ├── report_router.py      # Маршруты для генерации отчетов.
        │   ├── transaction_router.py # Маршруты для управления транзакциями.
        │   └── verify_router.py      # Маршруты для верификации данных.
        ├── core
        │   └── settings.py   # Файл с конфигурацией приложения (настройки, переменные окружения).
        ├── main.py           # Точка входа в приложение, где инициализируется FastAPI.
        └── schemas           # Схемы данных (Pydantic models), используемые в API.
            ├── auth_schemas.py        # Схемы для аутентификации.
            ├── report_schemas.py      # Схемы для отчетов.
            ├── transaction_schemas.py # Схемы для транзакций.
            └── verify_schemas.py      # Схемы для верификации данных.
```

## Описание сервиса

Отвечает за проксирование запросов в сервисы. С помощью `docker-compose` запускается группа контейнеров отвечающих за внешние сервера:
1. Авторизации
2. Транзакций
3. верификации

Для работы с сервисом верификаци изапускается дополнительно два контейнера для работы с брокером сообщений `Kafka`

### Submodules
В проекте используются git submodule позволяющие использовать стороние репозитории в основном проекте отдельно (в плане работы с контролем версий)

### Ошибки
Исключения на стороне сервисов траслируются через `API Gateway` клиенту

### Переменные окружения проекта
Передаются в `docker-compose.yml`, указание адресов сервисов передается явно в сервисе `API Gateway`
По данным путям будет обмен информацией с сервисами
Пример
```bash
environment:
        - APP_CONFIG__url__auth=http://auth_container:8000
        - APP_CONFIG__url__transaction=http://transaction_container:8000
        - APP_CONFIG__url__verification=http://verification_container:8000
```

Для переменных интимного характера, такие как секретный ключ, алгоритм шифрования и время действия токена используется файл .env (`.env-dev` в данном проекте) который указывается в `docker-compose.yml`.
Пример:
```bash
`docker-compose.yml`
env_file:
        - .env-dev

`.env-dev`
APP_CONFIG__JWT__algorithm=HS256
APP_CONFIG__JWT__secret_key=SECRETKEY
APP_CONFIG__JWT__access_token_expire_minutes=30
```


